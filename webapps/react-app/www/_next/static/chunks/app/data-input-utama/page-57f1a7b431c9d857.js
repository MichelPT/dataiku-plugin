(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{292:(e,t,l)=>{"use strict";l.d(t,{m:()=>s});let s=(0,l(5453).v)(e=>({stagedStructure:null,qcResults:null,handledFiles:[],setStagedStructure:t=>e({stagedStructure:t}),setQcResults:t=>e({qcResults:t}),addHandledFile:t=>e(e=>({handledFiles:[...e.handledFiles,t]})),clearQcResults:()=>e({qcResults:null,handledFiles:[]}),clearAllData:()=>e({stagedStructure:null,qcResults:null,handledFiles:[]})}))},4433:(e,t,l)=>{Promise.resolve().then(l.bind(l,7614))},7614:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>b});var s=l(5155),a=l(2115),n=l(5695),r=l(408),i=l.n(r),c=l(292),d=l(2657),o=l(9946);let u=(0,o.A)("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var m=l(1380);let h=(0,o.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),x=(0,o.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var p=l(7434);let g=e=>{let{file:t}=e;return t&&t.headers&&0!==t.headers.length&&t.content&&0!==t.content.length?(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100 sticky top-0 z-10",children:(0,s.jsx)("tr",{children:t.headers.map((e,t)=>(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600 uppercase tracking-wider",children:e},t))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.content.slice(0,1e3).map((e,l)=>(0,s.jsx)("tr",{className:"hover:bg-gray-50",children:t.headers.map((t,l)=>{var a,n;return(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-gray-800",title:String(null!=(a=e[t])?a:""),children:String(null!=(n=e[t])?n:"")},l)})},l))})]})}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"text-center text-gray-400",children:[(0,s.jsx)(d.A,{className:"mx-auto w-16 h-16 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium",children:"No File Selected"}),(0,s.jsx)("p",{children:"Select a file from the list to preview its contents."})]})})};function b(){let e=(0,n.useRouter)(),{stagedStructure:t,qcResults:l,handledFiles:r,setQcResults:d,addHandledFile:o,clearAllData:b,clearQcResults:f}=(0,c.m)(),[y,N]=(0,a.useState)(!1),[j,w]=(0,a.useState)("input"),[v,S]=(0,a.useState)(null),[k,_]=(0,a.useState)(null),[A,C]=(0,a.useState)(!1),[E,R]=(0,a.useState)("");(0,a.useEffect)(()=>{t||e.replace("/input")},[t,e]);let F=async()=>{if(t){C(!0),R("Step 1: Running initial Quality Control..."),f(),w("output"),_(null),S(null);try{let e=t.files.map(e=>({name:e.originalName||e.name,content:e.rawContentString})),l=await fetch("/api/run-qc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:e})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.details||"Initial QC failed")}let s=await l.json();d(s),await L(s)}catch(e){alert("An error occurred during QC: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{C(!1),R("")}}},L=async e=>{let t=e.qc_summary.filter(e=>"HAS_NULL"===e.status);if(0===t.length){R("QC complete. No files with nulls to handle."),setTimeout(()=>R(""),3e3);return}for(let l of(R("Step 2: Found ".concat(t.length," file(s) with nulls. Auto-handling...")),t))try{let t=Object.keys(e.output_files).find(e=>e.startsWith(l.well_name));if(!t)continue;let s=e.output_files[t],a=await fetch("/api/handle-nulls",{method:"POST",headers:{"Content-Type":"text/plain"},body:s});if(!a.ok)throw Error("Server failed to handle nulls for ".concat(l.well_name));let n=await a.text(),r=await new Promise((e,t)=>{i().parse(n,{header:!0,skipEmptyLines:!0,complete:e,error:t})});o({id:"handled_".concat(l.well_name),name:"".concat(l.well_name,"_HANDLED.csv"),content:r.data,headers:r.meta.fields||[]})}catch(e){console.error("Failed to handle nulls for ".concat(l.well_name,":"),e)}R("Automated null handling complete."),setTimeout(()=>R(""),3e3)},O=e=>{switch(e){case"PASS":return"bg-green-50 hover:bg-green-100";case"MISSING_LOGS":case"ERROR":return"bg-red-50 hover:bg-red-100";case"HAS_NULL":case"EXTREME_VALUES":return"bg-yellow-50 hover:bg-yellow-100";default:return"hover:bg-gray-50"}},q=e=>{switch(e){case"PASS":return"bg-green-100 text-green-800";case"MISSING_LOGS":case"ERROR":return"bg-red-100 text-red-800";case"HAS_NULL":case"EXTREME_VALUES":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},I=e=>{S(e.id),_({id:e.id,name:e.name,content:e.content,headers:e.headers})},P=e=>{S(e.id),_(e)},Q=e=>{if(!l)return;S(e.well_name);let t=Object.keys(l.output_files).find(t=>t.startsWith(e.well_name));t&&l.output_files[t]?i().parse(l.output_files[t],{header:!0,skipEmptyLines:!0,complete:l=>_({id:e.well_name,name:t,content:l.data,headers:l.meta.fields||[]})}):_({id:e.well_name,name:"".concat(e.well_name," (No file content)"),content:[],headers:["Info"]})};return t?(0,s.jsxs)("div",{className:"flex h-screen bg-gray-50 text-gray-800",children:[(0,s.jsxs)("div",{className:"w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col p-4",children:[(0,s.jsx)("h1",{className:"text-xl font-bold mb-6",children:"Data Input Utama"}),(0,s.jsxs)("nav",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:()=>{w("input"),_(null),S(null)},className:"w-full flex items-center gap-3 p-2 rounded-md text-sm font-medium transition-colors ".concat("input"===j?"bg-blue-100 text-blue-700":"hover:bg-gray-100"),children:[(0,s.jsx)(u,{className:"w-5 h-5"})," ",t.userDefinedStructureName," (Input)"]}),(0,s.jsxs)("button",{onClick:()=>{w("output"),_(null),S(null)},disabled:!l,className:"w-full flex items-center gap-3 p-2 rounded-md text-sm font-medium transition-colors ".concat("output"===j?"bg-blue-100 text-blue-700":"hover:bg-gray-100"," disabled:text-gray-400 disabled:cursor-not-allowed"),children:[(0,s.jsx)(m.A,{className:"w-5 h-5"})," Output"]}),(0,s.jsxs)("button",{onClick:()=>{w("handled"),_(null),S(null)},disabled:0===r.length,className:"w-full flex items-center gap-3 p-2 rounded-md text-sm font-medium transition-colors ".concat("handled"===j?"bg-blue-100 text-blue-700":"hover:bg-gray-100"," disabled:text-gray-400 disabled:cursor-not-allowed"),children:[(0,s.jsx)(h,{className:"w-5 h-5 text-green-500"})," ABB (pass_qc)"]})]}),(0,s.jsxs)("div",{className:"mt-auto pt-4 space-y-2 border-t",children:[(0,s.jsx)("button",{onClick:F,disabled:A||y,className:"w-full px-4 py-3 bg-green-500 text-white font-bold rounded hover:bg-green-600 disabled:bg-gray-400 flex items-center justify-center gap-2",children:A?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x,{className:"w-5 h-5 animate-spin"}),"Processing..."]}):"Run Quality Control"}),(0,s.jsx)("button",{onClick:()=>{N(!0),e.push("/plot-display")},disabled:y||A,className:"w-full px-4 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600 flex items-center justify-center transition-colors disabled:bg-gray-400 disabled:cursor-wait",children:y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x,{className:"mr-2 h-5 w-5 animate-spin"}),"Loading..."]}):"Continue"}),(0,s.jsx)("button",{onClick:()=>{b(),e.push("/input")},className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Start New Session"})]})]}),(0,s.jsxs)("div",{className:"flex-1 bg-gray-100 border-r border-gray-200 flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b font-semibold text-lg bg-white",children:["input"===j&&'Files in "'.concat(t.userDefinedStructureName,'"'),"output"===j&&"Initial QC Results","handled"===j&&"Handled Files (ABB pass_qc)"]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["input"===j&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"File Name"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Original Type"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.files.map(e=>(0,s.jsxs)("tr",{onClick:()=>I(e),className:"cursor-pointer hover:bg-blue-50 ".concat(v===e.id?"bg-blue-100":""),children:[(0,s.jsxs)("td",{className:"px-4 py-2 flex items-center gap-2 text-black",children:[(0,s.jsx)(p.A,{className:"w-4 h-4 text-gray-400"}),e.name]}),(0,s.jsx)("td",{className:"px-4 py-2 text-black",children:e.type})]},e.id))})]}),"output"===j&&l&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Well Name"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Details"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:l.qc_summary.map(e=>(0,s.jsxs)("tr",{onClick:()=>Q(e),className:"cursor-pointer ".concat(O(e.status)," ").concat(v===e.well_name?"border-l-4 border-blue-500":""),children:[(0,s.jsx)("td",{className:"px-4 py-2 font-medium text-black",children:e.well_name}),(0,s.jsx)("td",{className:"px-4 py-2",children:(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full ".concat(q(e.status)),children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-2 text-black",children:e.details})]},e.well_name))})]}),"handled"===j&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsx)("tr",{children:(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Handled File Name"})})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map(e=>(0,s.jsx)("tr",{onClick:()=>P(e),className:"cursor-pointer hover:bg-blue-50 ".concat(v===e.id?"bg-blue-100":""),children:(0,s.jsxs)("td",{className:"px-4 py-2 flex items-center gap-2 text-black",children:[(0,s.jsx)(h,{className:"w-4 h-4 text-green-500"}),e.name]})},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:1,className:"p-4 text-center text-gray-500",children:"No files have been processed for null values yet."})})})]}),A&&(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500 flex items-center justify-center gap-2",children:[(0,s.jsx)("div",{className:"w-5 h-5 border-t-2 border-gray-500 rounded-full animate-spin"}),E||"Processing..."]}),"output"===j&&!l&&!A&&(0,s.jsx)("div",{className:"p-8 text-center text-gray-400",children:"Run Quality Control to see the output here."})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col bg-white",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsx)("h2",{className:"font-semibold text-lg",children:"File Preview"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 truncate",children:k?k.name:"No file selected"})]}),(0,s.jsx)(g,{file:k})]})]}):(0,s.jsx)("div",{className:"h-screen w-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)("p",{children:"Loading data or redirecting..."})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[272,441,684,358],()=>t(4433)),_N_E=e.O()}]);